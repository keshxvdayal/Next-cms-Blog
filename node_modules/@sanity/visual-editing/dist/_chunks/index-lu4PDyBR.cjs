"use strict";var e=require("@vercel/stega"),t=require("react/jsx-runtime");let n;const r=new Uint8Array(16);function o(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}const s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function a(e,t,n){if(i.randomUUID&&!t&&!e)return i.randomUUID();const r=(e=e||{}).random||(e.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}(r)}const c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,u=/_key\s*==\s*['"](.*)['"]/,l=/^\d*:\d*$/;function p(e){return"number"==typeof e||"string"==typeof e&&/^\[\d+\]$/.test(e)}function f(e){return"string"==typeof e?u.test(e.trim()):"object"==typeof e&&"_key"in e}function d(e){if("string"==typeof e&&l.test(e))return!0;if(!Array.isArray(e)||2!==e.length)return!1;const[t,n]=e;return!("number"!=typeof t&&""!==t||"number"!=typeof n&&""!==n)}function y(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce(((e,t,n)=>{const r=typeof t;if("number"===r)return"".concat(e,"[").concat(t,"]");if("string"===r){const r=0===n?"":".";return"".concat(e).concat(r).concat(t)}if(f(t)&&t._key)return"".concat(e,'[_key=="').concat(t._key,'"]');if(Array.isArray(t)){const[n,r]=t;return"".concat(e,"[").concat(n,":").concat(r,"]")}throw new Error("Unsupported path segment `".concat(JSON.stringify(t),"`"))}),"")}function m(e){if("string"!=typeof e)throw new Error("Path is not a string");const t=e.match(c);if(!t)throw new Error("Invalid path string");return t.map(h)}function h(e){return p(e)?function(e){return Number(e.replace(/[^\d]/g,""))}(e):f(e)?function(e){const t=e.match(u);return{_key:t[1]}}(e):d(e)?function(e){const[t,n]=e.split(":").map((e=>""===e?e:Number(e)));return[t,n]}(e):e}var v=Object.freeze({__proto__:null,fromString:m,get:function(e,t,n){const r="string"==typeof t?m(t):t;if(!Array.isArray(r))throw new Error("Path must be an array or a string");let o=e;for(let e=0;e<r.length;e++){const t=r[e];if(p(t)){if(!Array.isArray(o))return n;o=o[t]}if(f(t)){if(!Array.isArray(o))return n;o=o.find((e=>e._key===t._key))}if("string"==typeof t&&(o="object"==typeof o&&null!==o?o[t]:void 0),void 0===o)return n}return o},isIndexSegment:p,isIndexTuple:d,isKeySegment:f,reKeySegment:u,toString:y});const g="drafts.";var b,E,w,k,x=class extends Error{issues;constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function _(e,t){return Array.isArray(e)?[void 0,e]:[e,t]}function L(e){return{lang:e?.lang??b?.lang,message:e?.message,abortEarly:e?.abortEarly??b?.abortEarly,abortPipeEarly:e?.abortPipeEarly??b?.abortPipeEarly,skipPipe:e?.skipPipe??b?.skipPipe}}function P(e,t,n,r){const o=e.message??function(e,t){return k?.get(e)?.get(t)}(t,r.lang)??("type"===e.type?(s=r.lang,w?.get(s)):null)??n?.message??function(e){return E?.get(e)}(r.lang)??r.message;var s;return"function"==typeof o?o(r):o}function A(e,t,n){return{typed:e,output:t,issues:n}}function I(e){let t=typeof e;return"object"===t&&(t=e?Object.getPrototypeOf(e).constructor.name:"null"),"string"===t?`"${e}"`:"number"===t||"bigint"===t||"boolean"===t?`${e}`:t}function U(e,t,n){const r=n.received??I(n.input),o={reason:e.type,context:n.context.type,expected:n.context.expects,received:r,message:`Invalid ${n.label}: ${n.context.expects?`Expected ${n.context.expects} but r`:"R"}eceived ${r}`,input:n.input,requirement:n.context.requirement,path:n.path,lang:t?.lang,abortEarly:t?.abortEarly,abortPipeEarly:t?.abortPipeEarly,skipPipe:t?.skipPipe};return o.message=P(n.context,n.reference,t,o),o}function j(e,t,n,r){if(e.pipe&&!n?.skipPipe)for(const o of e.pipe){const s=o._parse(t);if(s.issues){for(const t of s.issues){const o=U(e,n,t);r?r.push(o):r=[o]}if(n?.abortEarly||n?.abortPipeEarly)break}else t=s.output}return A(!0,t,r)}function T(e,t,n,r,o){const s=I(n),i=o?.expected??e.expects,a={reason:o?.reason??"type",context:e.type,expected:i,received:s,message:`Invalid type: Expected ${i} but received ${s}`,input:n,path:o?.path,issues:o?.issues,lang:r?.lang,abortEarly:r?.abortEarly,abortPipeEarly:r?.abortPipeEarly,skipPipe:r?.skipPipe};return a.message=P(e,t,r,a),{typed:!1,output:n,issues:[a]}}function N(e,t,n,r){const[o,s,i]=function(e,t,n){if(!e||"object"==typeof e&&!Array.isArray(e)){const[r,o]=_(t,n);return[e,r,o]}const[r,o]=_(e,t);return[void 0,r,o]}(t,n,r);let a;return{type:"object",expects:"Object",async:!1,entries:e,rest:o,message:s,pipe:i,_parse(e,t){if(e&&"object"==typeof e){a=a??Object.entries(this.entries);let n,r=!0;const o={};for(const[s,i]of a){const a=e[s],c=i._parse(a,t);if(c.issues){const o={type:"object",origin:"value",input:e,key:s,value:a};for(const e of c.issues)e.path?e.path.unshift(o):e.path=[o],n?.push(e);if(n||(n=c.issues),t?.abortEarly){r=!1;break}}c.typed||(r=!1),(void 0!==c.output||s in e)&&(o[s]=c.output)}if(this.rest&&(!t?.abortEarly||!n))for(const s in e)if(!(s in this.entries)){const i=e[s],a=this.rest._parse(i,t);if(a.issues){const o={type:"object",origin:"value",input:e,key:s,value:i};for(const e of a.issues)e.path?e.path.unshift(o):e.path=[o],n?.push(e);if(n||(n=a.issues),t?.abortEarly){r=!1;break}}a.typed||(r=!1),o[s]=a.output}return r?j(this,o,t,n):A(!1,o,n)}return T(this,N,e,t)}}}function S(e,t,n){const r=e._parse(t,L(n));return{typed:r.typed,success:!r.issues,data:r.output,output:r.output,error:r.issues&&new x(r.issues),issues:r.issues}}function O(e){return null!==e&&Array.isArray(e)}const R=/^([A-Za-z]+):([0-9]+)$/,$=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,M=/^([A-Za-z]+):([a-z0-9]+)$/;const C=function e(t,n){const[r,o]=_(t,n);return{type:"string",expects:"string",async:!1,message:r,pipe:o,_parse(t,n){return"string"==typeof t?j(this,t,n):T(this,e,t,n)}}}([function e(t,n){return{type:"min_length",expects:`>=${t}`,async:!1,message:n,requirement:t,_parse(t){return t.length>=this.requirement?{output:t}:function(e,t,n,r,o){return{issues:[{context:e,reference:t,input:n,label:r,received:o}]}}(this,e,t,"length",`${t.length}`)}}}(1)]),D={type:"optional",expects:`${(H=C).expects} | undefined`,async:!1,wrapped:H,default:V,_parse(e,t){if(void 0===e){const t="function"==typeof(n=this).default?n.default():n.default;if(void 0===t)return A(!0,e);e=t}var n;return this.wrapped._parse(e,t)}},z=N({id:C,path:C,type:D,baseUrl:C,workspace:D,tool:D}),q=N({origin:C,href:C,data:D});var H,V;function G(e){return t=e,!z._parse(t,{abortEarly:!0,skipPipe:L(n)?.skipPipe}).issues;var t,n}function J(e){const t=e.split(";").reduce(((e,t)=>{const[n,r]=t.split("=");if(!n||!r)return e;switch(n){case"id":e.id=r;break;case"type":e.type=r;break;case"path":e.path=v.toString(function(e){const t=[];for(const n of e.split(".")){const e=R.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=$.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const o=M.exec(n);o?t.push(o[1],{_key:o[2]}):t.push(n)}return t}(r));break;case"base":e.baseUrl=decodeURIComponent(r);break;case"tool":e.tool=r;break;case"workspace":e.workspace=r}return e}),{});if(G(t))return t}function W(e){try{return function(e){const t=S(z,e);if(t.success)return t.output;const n=S(q,e);if(n.success)try{const e=new URL(n.output.href,"undefined"==typeof document?"https://example.com":location.origin);return e.searchParams.size>0?function(e,t,n){const r=e._parse(t,L(n));if(r.issues)throw new x(r.issues);return r.output}(z,Object.fromEntries(e.searchParams.entries())):n.output}catch(e){return console.error("Failed to parse sanity node",e),n.output}}(JSON.parse(e))}catch{return J(e)}}const X="sanity-visual-editing";function Z(e){const{display:t}=window.getComputedStyle(e);if("inline"!==t)return e;const n=e.parentElement;return n?Z(n):null}function K(t,n=!1){return r=t,e.VERCEL_STEGA_REGEX.lastIndex=0,e.VERCEL_STEGA_REGEX.test(r)?function(t,n=!1){var r;const o=e.vercelStegaDecode(t);return o&&"sanity.io"===o.origin?(n&&(o.href=null==(r=o.href)?void 0:r.replace(".alt","")),JSON.stringify(o)):""}(t,n):"";var r}const B=e=>e.nodeType===Node.ELEMENT_NODE,F=e=>"IMG"===e.tagName,Y=e=>"TIME"===e.tagName;function Q(e){return"path"in e}function ee(e,t){let n=e.split("."),r=t.split(".");const o=Math.min(n.length,r.length);return n=n.slice(0,o).reverse(),r=r.slice(0,o).reverse(),n.reduce(((e,t,n)=>t===r[n]?[...e,t]:[]),[]).reverse().join(".")}function te(e){if(!e.length||!e.map((e=>Q(e))).every(((e,t,n)=>e===n[0])))return;if(!Q(e[0]))return e[0];const t=e.filter(Q);let n=e[0];const r=["projectId","dataset","id","baseUrl","workspace","tool"];for(let e=1;e<t.length;e++){const o=t[e];if(r.some((e=>o[e]!==(null==n?void 0:n[e])))){n=void 0;break}n.path=ee(n.path,o.path)}return n}function ne(e){var t,n,r;const o=[];function s(e,t){const n=W(t);if(!n)return;const r=Z(e);r&&o.push({elements:{element:e,measureElement:r},sanity:n})}if(e)for(const i of e.childNodes){const{nodeType:e,parentElement:a,textContent:c}=i;if(B(i)&&void 0!==(null==(t=i.dataset)?void 0:t.sanityEditTarget)){const e=ne(i).map((({sanity:e})=>e));if(!e.map((e=>Q(e))).every(((e,t,n)=>e===n[0])))continue;const t=te(e);t&&o.push({elements:{element:i,measureElement:i},sanity:t})}else if(e===Node.TEXT_NODE&&a&&c){const e=K(c);if(!e)continue;s(a,e)}else if(B(i)){if("SCRIPT"===i.tagName||i.id===X)continue;if(null==(n=i.dataset)?void 0:n.sanity)s(i,i.dataset.sanity);else if(null==(r=i.dataset)?void 0:r.sanityEditInfo)s(i,i.dataset.sanityEditInfo);else{if(F(i)){const e=K(i.alt,!0);if(!e)continue;s(i,e);continue}if(Y(i)){s(i,K(i.dateTime,!0))}}o.push(...ne(i))}}return o}function re(e){const t=e.getBoundingClientRect();return{x:t.x+scrollX,y:t.y+scrollY,w:t.width,h:t.height}}let oe=null,se=null,ie=null;exports.a=function({handler:e,overlayElement:t,preventDefault:n}){let r=!1;const o=new Map,s=new WeakMap,i=new Set,c=new WeakMap;let u,l,p,f=[];const d=()=>f[f.length-1];function y(e,t){e.removeEventListener("click",t.click,{capture:!0}),e.removeEventListener("mousemove",t.mousemove,{capture:!0}),e.removeEventListener("mousedown",t.mousedown,{capture:!0}),e.removeEventListener("mouseenter",t.mouseenter),e.removeEventListener("mouseleave",t.mouseleave)}function m({id:t,elements:n,handlers:r,sanity:o}){const{element:s,measureElement:i}=n;!function(e,t){e.addEventListener("click",t.click,{capture:!0}),e.addEventListener("mousemove",t.mousemove,{once:!0,capture:!0}),e.addEventListener("mousedown",t.mousedown,{capture:!0})}(s,r),u.observe(i),e({type:"element/activate",id:t,rect:re(s),sanity:o})}function h({id:t,elements:n,handlers:r}){const{element:o,measureElement:s}=n;y(o,r),u.unobserve(s),f=f.filter((e=>e!==o)),e({type:"element/deactivate",id:t})}function v({elements:r,sanity:p}){const{element:y,measureElement:h}=r,v={click(t){const r=t.target;y===d()&&y.contains(r)&&(n&&(t.preventDefault(),t.stopPropagation()),e({type:"element/click",id:g,sanity:p}))},mousedown(e){e.preventDefault()},mousemove(e){v.mouseenter(e);const t=e.currentTarget;t&&(t.addEventListener("mouseenter",v.mouseenter),t.addEventListener("mouseleave",v.mouseleave))},mouseenter(){f.push(y),e({type:"element/mouseenter",id:g,rect:re(y)})},mouseleave(n){function r(){f.pop();const t=d();if(e({type:"element/mouseleave",id:g}),t){const n=s.get(t);n&&e({type:"element/mouseenter",id:n.id,rect:re(t)})}}const{relatedTarget:o}=n;if(o instanceof HTMLElement&&t.contains(o)){const e=()=>{r(),o.removeEventListener("mouseleave",e)};o.addEventListener("mouseleave",e)}else r()}},g=a(),b={id:g,elements:r,sanity:p,handlers:v};i.add(y),c.set(h,y),o.set(g,y),s.set(y,b),l.observe(y),u.observe(h),e({type:"element/register",id:g,rect:re(y),sanity:p}),m(b)}function g(e){const t=ne(e);for(const e of t)e.elements.element instanceof HTMLElement&&!s.has(e.elements.element)&&v(e)}function b(t){const n=s.get(t);if(n){const{id:r,handlers:a}=n;y(t,a),u.unobserve(t),s.delete(t),i.delete(t),o.delete(r),e({type:"element/unregister",id:r})}}function E(e){const n=!!e.filter((e=>{const n=e.target;if(n===t||t.contains(n))return!1;if(n instanceof HTMLElement)if(s.has(n)){ne({childNodes:[n]}).length||b(n)}else g({childNodes:[n]});return!0})).length;if(n)for(const e of i)e.isConnected?w(e):b(e)}function w(t){const n=s.get(t);n&&e({type:"element/updateRect",id:n.id,rect:re(t)})}function k(e){for(const t of e){const e=t.target;if(e instanceof HTMLElement){const t=c.get(e);if(!t)return;w(t)}}}function x(e){for(const t of e){const{target:e}=t,n=e instanceof HTMLElement&&s.get(e);n&&(t.isIntersecting?m(n):h(n))}}function _(){f=[],e({type:"overlay/blur"})}function L(){for(const e of i)w(e)}function P(e){const{target:t}=e;if(t!==window.document&&t instanceof HTMLElement)for(const e of i)t.contains(e)&&w(e)}function A(){r||(window.addEventListener("click",_),window.addEventListener("resize",L),window.addEventListener("scroll",P,{capture:!0,passive:!0}),l=new IntersectionObserver(x,{threshold:.3}),u=new ResizeObserver(k),p=new MutationObserver(E),p.observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),g(document.body),r=!0,e({type:"overlay/activate"}))}return window.document.fonts.ready.then((()=>{for(const e of i)w(e)})),A(),{activate:A,deactivate:function(){r&&(window.removeEventListener("click",_),window.removeEventListener("resize",L),window.removeEventListener("scroll",P),l.disconnect(),p.disconnect(),u.disconnect(),i.forEach((e=>{b(e)})),o.clear(),i.clear(),f=[],r=!1,e({type:"overlay/deactivate"}))}}},exports.c=function(e){const{baseUrl:t,workspace:n="default",tool:r="default",id:o,type:s,path:i}=e;if(!t)throw new Error("baseUrl is required");if(!i)throw new Error("path is required");if(!o)throw new Error("id is required");if("/"!==t&&t.endsWith("/"))throw new Error("baseUrl must not end with a slash");const a="default"===n?void 0:n,c="default"===r?void 0:r,u=function(e){return e.startsWith(g)?e.slice(g.length):e}(o),l=Array.isArray(i)?y(function(e){return e.map((e=>{if("string"==typeof e)return e;if("number"==typeof e)return e;if(""!==e._key)return{_key:e._key};if(-1!==e._index)return e._index;throw new Error("invalid segment:".concat(JSON.stringify(e)))}))}(i)):i,p=new URLSearchParams({baseUrl:t,id:u,type:s,path:l});a&&p.set("workspace",a),c&&p.set("tool",c);const f=["/"===t?"":t];a&&f.push(a);const d=["mode=presentation","id=".concat(u),"type=".concat(s),"path=".concat(encodeURIComponent(l))];return c&&d.push("tool=".concat(c)),f.push("intent","edit","".concat(d.join(";"),"?").concat(p)),f.join("/")},exports.e=function(e={}){ie&&clearTimeout(ie);const n=new AbortController;return Promise.all([import("react-dom/client"),Promise.resolve().then((function(){return require("./Overlays-zTTVgkwb.cjs")}))]).then((([r,{Overlays:o}])=>{if(n.signal.aborted)return;const{history:s,zIndex:i}=e;if(oe||(oe=document.createElement("div"),oe.id=X,document.body.appendChild(oe)),!se){const{createRoot:e}="default"in r?r.default:r;se=e(oe)}se.render(t.jsx(o,{history:s,zIndex:i}))})),()=>{n.abort(),ie=window.setTimeout((()=>{se&&(se.unmount(),se=null),oe&&(document.body.removeChild(oe),oe=null)}),1e3)}},exports.o=function(e){let t="";for(const n of e)"string"!=typeof n?"number"!=typeof n?O(n)?(t&&(t+=":"),t+="".concat(n.join(","),"}")):n._key&&(t&&(t+=":"),t+="".concat(n._key)):(t&&(t+=":"),t+="".concat(n)):(t&&(t+="."),t+=n);return t},exports.s=v,exports.v=a;//# sourceMappingURL=index-lu4PDyBR.cjs.map
