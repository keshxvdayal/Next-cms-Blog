{"version":3,"file":"VisualEditingComponent-Y56UGEjm.cjs","sources":["../../src/next-pages-router/VisualEditingComponent.tsx"],"sourcesContent":["import {\n  enableVisualEditing,\n  type HistoryAdapterNavigate,\n  type VisualEditingOptions,\n} from '@sanity/visual-editing'\nimport { useRouter } from 'next/router.js'\nimport { useEffect, useRef, useState } from 'react'\n\n/**\n * @public\n */\nexport interface VisualEditingProps\n  extends Omit<VisualEditingOptions, 'history'> {\n  /**\n   * @deprecated The histoy adapter is already implemented\n   */\n  history?: never\n}\n\nexport default function VisualEditingComponent(\n  props: VisualEditingProps,\n): null {\n  const { zIndex } = props\n\n  const router = useRouter()\n  const routerRef = useRef(router)\n  const [navigate, setNavigate] = useState<HistoryAdapterNavigate | undefined>()\n\n  useEffect(() => {\n    routerRef.current = router\n  }, [router])\n  useEffect(() => {\n    const disable = enableVisualEditing({\n      zIndex,\n      history: {\n        subscribe: (_navigate) => {\n          setNavigate(() => _navigate)\n          return () => setNavigate(undefined)\n        },\n        update: (update) => {\n          switch (update.type) {\n            case 'push':\n              return routerRef.current.push(update.url)\n            case 'pop':\n              return routerRef.current.back()\n            case 'replace':\n              return routerRef.current.replace(update.url)\n            default:\n              throw new Error(`Unknown update type: ${update.type}`)\n          }\n        },\n      },\n    })\n    return () => disable()\n  }, [zIndex])\n\n  const { asPath, basePath, locale, isReady } = useRouter()\n  useEffect(() => {\n    if (navigate && isReady) {\n      const url =\n        basePath || locale\n          ? `${basePath}${locale ? `/${locale}` : ''}${asPath === '/' ? '' : asPath}`\n          : asPath\n      navigate({ type: 'push', url })\n    }\n  }, [asPath, basePath, isReady, locale, navigate])\n\n  return null\n}\n"],"names":["exports","default","props","zIndex","router","useRouter","routerRef","useRef","navigate","setNavigate","useState","useEffect","current","disable","enableVisualEditing","history","subscribe","_navigate","update","type","push","url","back","replace","Error","concat","asPath","basePath","locale","isReady"],"mappings":"oGAoEAA,QAAAC,QAjDA,SACEC,GAEM,MAAAC,OAAEA,GAAWD,EAEbE,EAASC,EAAAA,YACTC,EAAYC,SAAOH,IAClBI,EAAUC,GAAeC,EAA6CA,WAE7EC,EAAAA,WAAU,KACRL,EAAUM,QAAUR,CAAA,GACnB,CAACA,IACJO,EAAAA,WAAU,KACR,MAAME,EAAUC,EAAAA,oBAAoB,CAClCX,SACAY,QAAS,CACPC,UAAYC,IACVR,GAAY,IAAMQ,IACX,IAAMR,OAAY,IAE3BS,OAASA,IACP,OAAQA,EAAOC,MACb,IAAK,OACH,OAAOb,EAAUM,QAAQQ,KAAKF,EAAOG,KACvC,IAAK,MACI,OAAAf,EAAUM,QAAQU,OAC3B,IAAK,UACH,OAAOhB,EAAUM,QAAQW,QAAQL,EAAOG,KAC1C,QACE,MAAM,IAAIG,MAAM,wBAAwBC,OAAAP,EAAOC,OACnD,KAIN,MAAO,IAAMN,GAAQ,GACpB,CAACV,IAEJ,MAAMuB,OAAEA,EAAQC,SAAAA,EAAAC,OAAUA,EAAQC,QAAAA,GAAYxB,EAAAA,YAWvC,OAVPM,EAAAA,WAAU,KACR,GAAIH,GAAYqB,EAAS,CACvB,MAAMR,EACJM,GAAYC,EACR,GAAGH,OAAWE,GAAAF,OAAAG,EAAS,IAAIH,OAAAG,GAAW,IAAKH,OAAW,MAAXC,EAAiB,GAAKA,GACjEA,EACNlB,EAAS,CAAEW,KAAM,OAAQE,OAC3B,IACC,CAACK,EAAQC,EAAUE,EAASD,EAAQpB,IAEhC,IACT"}